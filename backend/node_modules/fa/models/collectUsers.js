// Part of <https://miracle.systems/p/walkner-fa> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (model, props, userSet) =>
{
  if (!userSet)
  {
    userSet = new Set();
  }

  if (model.stageChangedBy)
  {
    Object.keys(model.stageChangedBy).forEach(stage =>
    {
      const userInfo = model.stageChangedBy[stage];

      if (userInfo && userInfo._id)
      {
        userSet.add(userInfo._id);
      }
    });
  }

  props.forEach(prop =>
  {
    const value = model[prop];

    if (!value)
    {
      return;
    }

    if (Array.isArray(value))
    {
      value.forEach(userInfo =>
      {
        if (userInfo._id)
        {
          userSet.add(userInfo._id);
        }
      });
    }
    else if (value._id)
    {
      userSet.add(value._id);
    }
  });

  return userSet;
};
