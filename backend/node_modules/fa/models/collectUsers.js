// Part of <https://miracle.systems/p/walkner-fa> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (model, props) =>
{
  const userSet = new Set();

  Object.keys(model.stageChangedBy).forEach(stage =>
  {
    const userInfo = model.stageChangedBy[stage];

    if (userInfo && userInfo._id)
    {
      userSet.add(userInfo._id);
    }
  });

  props.forEach(prop =>
  {
    const value = model[prop];

    if (!value)
    {
      return;
    }

    if (Array.isArray(value))
    {
      value.forEach(userInfo =>
      {
        if (userInfo._id)
        {
          userSet.add(userInfo._id);
        }
      });
    }
    else if (value._id)
    {
      userSet.add(value._id);
    }
  });

  model.users = Array.from(userSet);
};
