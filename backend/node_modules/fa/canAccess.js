// Part of <https://miracle.systems/p/walkner-fa> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (app, module, userData, doc) =>
{
  // TODO
  return true;

  if (!userData
    || !Array.isArray(userData.privileges)
    || !userData.privileges.length)
  {
    return false;
  }

  const {privileges} = userData;

  if (privileges.includes('SUPER'))
  {
    return true;
  }

  const isUser = Array.isArray(doc.users) && doc.users.includes(userData._id);

  if (isUser)
  {
    return true;
  }

  if (privileges.includes('FA:VIEW:ALL'))
  {
    return true;
  }

  const isAllowed = privileges.includes(`${doc.constructor.PRIVILEGE_PREFIX}:${doc.stage}`);

  if (!isAllowed)
  {
    return false;
  }

  switch (doc.stage)
  {
    case 'accept':
    case 'record':
    case 'acceptOwner':
    case 'acceptFinance':
    case 'acceptDepartment':
      return true;
  }

  return false;
};
